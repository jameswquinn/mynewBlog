<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Begin Jekyll SEO tag v2.1.0 -->
<meta property="og:title" content="Jekyll environments" />
<meta name="description" content="When working with Jekyll and Siteleaf, you typically have 3 distinct environments to help you code, preview, and publish your site. Here are some tips &amp; tricks on using {{jekyll.environment}}." />
<meta property="og:description" content="When working with Jekyll and Siteleaf, you typically have 3 distinct environments to help you code, preview, and publish your site. Here are some tips &amp; tricks on using {{jekyll.environment}}." />
<link rel="canonical" href="http://localhost:4000/myBlog/blog/jekyll-environments/" />
<meta property="og:url" content="http://localhost:4000/myBlog/blog/jekyll-environments/" />
<meta property="og:site_name" content="Siteleaf" />
<meta property="og:image" content="http://localhost:4000/myBlog/uploads/usersnap.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-10-10T11:30:00-04:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@quinn" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Jekyll environments",
"image": "http://localhost:4000/myBlog/uploads/usersnap.png",
"datePublished": "2016-10-10T11:30:00-04:00",
"description": "When working with Jekyll and Siteleaf, you typically have 3 distinct environments to help you code, preview, and publish your site. Here are some tips &amp; tricks on using {{jekyll.environment}}.",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "http://localhost:4000/myBlog/assets/logo.svg"}},
"url": "http://localhost:4000/myBlog/blog/jekyll-environments/"}</script>
<!-- End Jekyll SEO tag -->

    
    <title>Jekyll environments - Siteleaf</title>
    <link rel="stylesheet" href="/myBlog/styles/milligram.css" />
    <!--
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.2.4/milligram.min.css" />
    -->
    <link rel="icon" type="image/x-icon" href="/myBlog/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Siteleaf: Blog (RSS)" href="http://localhost:4000/myBlogfeed.xml" />
  </head>
  <body class="post">
    
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-1666437-33', 'auto');
        ga('send', 'pageview');
      </script>
    
    <div class="container">
      
  <!-- blog permalink, inherit from first tag -->
  
  

<div class="headerWrap bg--red">
  <header class="header">
    <ul class="header__items">
      
      <li class="header__item">
        <a href="/myBlog/blog/" class="header__link">Blog</a>
      </li>
      
      <li class="header__item">
        <a href="/myBlog/gallery/" class="header__link">Gallery</a>
      </li>
      
      <li class="header__item">
        <a href="/myBlog/plans/" class="header__link">Plans</a>
      </li>
      
    </ul>
    <a href="/myBlog/" class="header__home"><img src="/myBlog/assets/logo.svg" class="header__logo" alt="Siteleaf" /></a>
    <h1 class="header__title">Jekyll environments</h1>
    
    
  </header>
</div>

        
      

<article class="article">
  
  
  <section class="article__meta">
    
      <ul class="article__tags">
        
          
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              <li class="article__tag"><a href="/myBlog/blog/tags/jekyll/" class="article__tag__link">Jekyll</a></li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              <li class="article__tag"><a href="/myBlog/blog/tags/tip/" class="article__tag__link">Tip</a></li>
            
          
            
            
          
            
            
          
            
            
          
        
      </ul>
    
    
    <time class="article__date" datetime="2016-10-10T11:30:00-04:00">Oct 10, 2016</time>
    
  </section>
  
  <section class="article__content">
    

    

    
      <p>When working with Jekyll and Siteleaf, you typically have 3 distinct environments to help you code, preview, and publish your site:</p>

<ol>
  <li>
    <p><code class="highlighter-rouge">development</code> - this is your local machine where theme development takes place. Run <code class="highlighter-rouge">jekyll serve</code> and your site will be accessible at <code class="highlighter-rouge">http://localhost:4000</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">staging</code> - sites on paid plans come with <a href="https://learn.siteleaf.com/sites/preview/">preview functionality</a>. Hit the “Generate preview” button in Siteleaf, and your site will be built with a unique URL without affecting your live site. This URL is shareable, so you can send it to colleagues outside of Siteleaf for feedback or proofreading.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">production</code> - where your final website is generated and hosted. This could be GitHub Pages, Amazon S3, Rackspace Cloud Files, or any host that supports (S)FTP (DigitalOcean, MediaTemple, etc).</p>
  </li>
</ol>

<p>Starting today, Siteleaf will now set the <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">jekyll.environment</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code> variable to one of the environments above (previously both preview and publish used <code class="highlighter-rouge">production</code>).</p>

<p>This allows you to set up conditional code in your theme to render content or add functionality based on the current environment. For example you may want to alter image processing, insert a message, disable analytics, or even conduct user testing in one of your environments.</p>

<h3 id="example-1-client-feedback-on-staging">Example 1: Client feedback on staging</h3>

<p><img src="/uploads/usersnap.png" alt="Using Usersnap to gather client feedback in Siteleaf" /></p>

<p>Let’s say we are working with a client on a new website. To help them provide constructive feedback during development, we can add a feedback widget to our site and enable it only on the <code class="highlighter-rouge">staging</code> (preview) environment.</p>

<p>There are <a href="https://www.quora.com/What-is-the-best-website-feedback-widget-available-for-free">many options</a> for feedback widgets including <a href="https://usersnap.com">Usersnap</a> and <a href="https://webengage.com">WebEngage</a>, but we’ll go with Usersnap since it supports annotated screenshots and can pipe responses right into our Slack channel.</p>

<p>We can simply wrap the embed code provided by Usersnap around a Liquid conditional to check if <code class="highlighter-rouge">jeyll.environment</code> is equal to <code class="highlighter-rouge">staging</code>:</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code>{% if jekyll.environment == 'staging' %}
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"script"</span><span class="p">);</span>
  <span class="nx">s</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">"text/javascript"</span><span class="p">;</span>
  <span class="nx">s</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">'//api.usersnap.com/load/'</span><span class="o">+</span>
          <span class="s1">'YOUR-TOKEN.js'</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'script'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="nx">x</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">x</span><span class="p">);</span>
  <span class="p">})();</span>
  <span class="nt">&lt;/script&gt;</span>
{% endif %}
</code></pre>
</div>

<h3 id="example-2-production-only-analytics">Example 2: Production-only analytics</h3>

<p>To keep our Google Analytics clean of test traffic, we can wrap the tracking code around a similar conditional checking for the <code class="highlighter-rouge">production</code> environment.</p>

<p>For good measure, we could also move the property ID to a <a href="https://learn.siteleaf.com/content/metadata/">site metadata</a> field called <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">site.google_analytics</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code> in case we later need to change it.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code>{% if jekyll.environment == 'production' %}
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">){</span><span class="nx">i</span><span class="p">[</span><span class="s1">'GoogleAnalyticsObject'</span><span class="p">]</span><span class="o">=</span><span class="nx">r</span><span class="p">;</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">||</span><span class="kd">function</span><span class="p">(){</span>
    <span class="p">(</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)},</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="k">new</span> <span class="nb">Date</span><span class="p">();</span><span class="nx">a</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">o</span><span class="p">),</span>
    <span class="nx">m</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">o</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span><span class="nx">a</span><span class="p">.</span><span class="nx">async</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">g</span><span class="p">;</span><span class="nx">m</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">)</span>
    <span class="p">})(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="s1">'script'</span><span class="p">,</span><span class="s1">'//www.google-analytics.com/analytics.js'</span><span class="p">,</span><span class="s1">'ga'</span><span class="p">);</span>
    <span class="nx">ga</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="s1">'{{ site.google_analytics }}'</span><span class="p">,</span> <span class="s1">'auto'</span><span class="p">);</span>
    <span class="nx">ga</span><span class="p">(</span><span class="s1">'send'</span><span class="p">,</span> <span class="s1">'pageview'</span><span class="p">);</span>
  <span class="nt">&lt;/script&gt;</span>
{% endif %}
</code></pre>
</div>

<h3 id="example-3-e-commerce-testing">Example 3: E-commerce testing</h3>

<p><a href="https://snipcart.com">Snipcart</a> is a simple way to add e-commerce to Siteleaf sites. It comes with both a Live and Test mode, so you can create sample purchases and test the checkout process in isolation. Each mode has a unique API key, so we can use <code class="highlighter-rouge">jekyll.environment</code> to apply the Live code to <code class="highlighter-rouge">production</code> and the Test code in <code class="highlighter-rouge">staging</code> and <code class="highlighter-rouge">development</code>.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code>{% if jekyll.environment == 'production' %}
  {% assign snipcart_api_key = 'LIVE-API-KEY' %}
{% else %}
  {% assign snipcart_api_key = 'TEST-API-KEY' %}
{% endif %}

<span class="nt">&lt;script 
  </span><span class="na">src=</span><span class="s">"https://cdn.snipcart.com/scripts/2.0/snipcart.js"</span> 
  <span class="na">data-api-key=</span><span class="s">"{{ snipcart_api_key }}"</span> 
  <span class="na">id=</span><span class="s">"snipcart"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<h3 id="testing-environments">Testing environments</h3>

<p>To test this functionality locally and ensure your conditionals work as intended, set <code class="highlighter-rouge">JEKYLL_ENV</code> when running <code class="highlighter-rouge">jekyll serve</code>. For example we could see how <code class="highlighter-rouge">production</code> would render:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nv">JEKYLL_ENV</span><span class="o">=</span>production bundle <span class="nb">exec </span>jekyll serve
</code></pre>
</div>

    
    
  </section>
</article>



    </div>
    <h1>footer</h1>

  </body>
</html>
